#   -------------------------------------------------------------
#   nginx :: configuration :: CORS + no cache :: open policy
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#   Project:        Nasqueron
#   Description:    nginx CORS configuration
#   Reference:      Michiel Kalkman, "Wide open nginx CORS configuration",
#                   https://michielkalkman.com/snippets/nginx-cors-open-configuration/
#   License:        Trivial work, not eligible for copyright.
#   Source file:    roles/webserver-core/nginx/files/includes/cors-open-no-cache
#   -------------------------------------------------------------
#
#   <auto-generated>
#       This file is managed by our rOPS SaltStack repository.
#
#       Changes to this file may cause incorrect behavior
#       and will be lost if the state is redeployed.
#   </auto-generated>

#   -------------------------------------------------------------
#   OPTIONS
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

if ($request_method = 'OPTIONS') {
    add_header 'Access-Control-Allow-Origin' '*';
    add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
    add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
    add_header 'Access-Control-Max-Age' 1728000;
    add_header 'Content-Type' 'text/plain; charset=utf-8';
    add_header 'Content-Length' 0;

    add_header 'X-Config-Type' 'cors-open-no-cache';
    expires off;
    add_header 'Cache-Control' 'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0';

    return 204;
 }

 #   -------------------------------------------------------------
 #   GET
 #   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

if ($request_method = 'GET') {
    add_header 'Access-Control-Allow-Origin' '*';
    add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
    add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
    add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';

    add_header 'X-Config-Type' 'cors-open-no-cache';
    expires off;
    add_header 'Cache-Control' 'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0';
}

#   -------------------------------------------------------------
#   POST
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

if ($request_method = 'POST') {
    add_header 'Access-Control-Allow-Origin' '*';
    add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
    add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
    add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';

    add_header 'X-Config-Type' 'cors-open-no-cache';
    expires off;
    add_header 'Cache-Control' 'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0';
}
