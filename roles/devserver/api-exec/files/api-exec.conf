#   -------------------------------------------------------------
#   API :: api-exec
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#   Project:        Nasqueron
#   License:        Trivial work, not eligible to copyright
#   Source file:    roles/devserver/api-exec/files/api-exec.conf
#   -------------------------------------------------------------
#
#   <auto-generated>
#       This file is managed by our rOPS SaltStack repository.
#
#       Changes to this file may cause incorrect behavior
#       and will be lost if the state is redeployed.
#   </auto-generated>

#   -------------------------------------------------------------
#   uWSGI
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

uwsgi:
  module: server
  callable: app

  http-socket: {{ internal_ip }}:{{ port }}

  master: true

  processes: {{ processes }}
  threads: 2

  chdir: {{ paths.app }}
  virtualenv: {{ paths.venv }}

  safe-pidfile: /var/run/api-exec.pid

#   -------------------------------------------------------------
#   Global environment
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

env:
  CCACHE_DIR: /var/cache/ccache
  PATH: "/bin:/usr/bin:/usr/local/bin"

#   -------------------------------------------------------------
#   Routes
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

routes:
  /status: echo 200 ALIVE

  /motd: motd
  /uptime: uptime
  /uname: uname -a

  /fortune: fortune
  /fortune/bofh: fortune bofh
  /fortune/epictetus: fortune epictetus
  /fortune/freebsd: fortune freebsd-classic
  /fortune/futurama: fortune futurama
  /fortune/tips: fortune freebsd-tips

  /metrics/ccache:
    command: ccache-metrics
    mime_type: application/openmetrics-text

  /version: cat /etc/os-release
  /version/runtime: freebsd-version -r
  /version/kernel: freebsd-version -k
  /version/userland: freebsd-version -u
