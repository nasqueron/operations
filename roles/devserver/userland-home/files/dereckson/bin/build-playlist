#!/bin/sh

#   -------------------------------------------------------------
#   Build a m3u playlist
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#   License:        BSD-2-Clause
#   Dependencies:   `url` to resolve a path into an URL
#   Source file:    roles/devserver/userland-home/files/dereckson/bin/build-playlist
#   -------------------------------------------------------------
#
#   <auto-generated>
#       This file is managed by our rOPS SaltStack repository.
#
#       Changes to this file may cause incorrect behavior
#       and will be lost if the state is redeployed.
#   </auto-generated>

set -e

#   -------------------------------------------------------------
#   Detect media files
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

is_media_file() {
    case "$1" in
        *.mp3|*.mp4|*.wav|*.m4a|*.flac|*.aac|*.mkv|*.avi|*.mov) return 0 ;;
        *) return 1 ;;
    esac
}

#   -------------------------------------------------------------
#   Build playlist
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

echo "#EXTM3U"
echo ""

for file in *; do
    if [ -f "$file" ] && is_media_file "$file"; then
        url "$file"
    fi
done
