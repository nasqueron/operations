#   -------------------------------------------------------------
#   Eglide â€” nginx configuration
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#   Project:        Eglide
#   Created:        2016-07-26
#   License:        Trivial work, not eligible to copyright
#   Source file:    roles/shellserver/web-hosting/files/eglide/nginx/vhosts/001-server.conf
#   -------------------------------------------------------------
#
#   <auto-generated>
#       This file is managed by our rOPS SaltStack repository.
#
#       Changes to this file may cause incorrect behavior
#       and will be lost if the state is redeployed.
#   </auto-generated>

#   -------------------------------------------------------------
#   Main vhost receives special responsibilities like serving
#   user directories.
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

    server {

        listen       80;
        listen       [::]:80;
        server_name  localhost eglide eglide.org eglide.nasqueron.org www.eglide.org [2001:470:1f12:896::2] [2001:470:1f13:896:0:c0de:15:11fe];
        root         /var/wwwroot/eglide.org/www;

        access_log   /var/log/www/eglide.org/www-access.log main;
        error_log    /var/log/www/eglide.org/www-error.log;

        ###
        ### SSL
        ###

        include includes/letsencrypt;

        include includes/tls;
        ssl_certificate          /etc/letsencrypt/live/www.eglide.org/fullchain.pem;
        ssl_certificate_key      /etc/letsencrypt/live/www.eglide.org/privkey.pem;

        ###
        ### Main site
        ###

        location / {
            index index.html index.htm default.html default.htm;
        }

        error_page 500 502 503 504 /50x.html;

        ###
        ### public_html user directories
        ###

        set $userdir public_html;

        location ~ ^/~(.+?)(/.*)?$ {
            alias /home/$1/$userdir$2;
            index index.html index.htm;
            autoindex on;
        }

    }
