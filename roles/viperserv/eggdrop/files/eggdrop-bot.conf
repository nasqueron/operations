#!/usr/bin/env eggdrop

#   -------------------------------------------------------------
#   Eggdrop configuration file
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#   License:        Trivial work, not eligible to copyright
#   Source file:    roles/viperserv/eggdrop/files/eggdrop-bot.conf
#   Pillar file:    pillar/viperserv/bots.sls
#   -------------------------------------------------------------
#
#   <auto-generated>
#       This file is managed by our rOPS SaltStack repository.
#
#       Changes to this file may cause incorrect behavior
#       and will be lost if the state is redeployed.
#   </auto-generated>
#
#    _    ___                 _____
#   | |  / (_)___  ___  _____/ ___/___  ______   __
#   | | / / / __ \/ _ \/ ___/\__ \/ _ \/ ___/ | / /
#   | |/ / / /_/ /  __/ /   ___/ /  __/ /   | |/ /
#   |___/_/ .___/\___/_/   /____/\___/_/    |___/
#        /_/
#
#                      [ 1993 technology for 2017 hackers ]
#
#   -------------------------------------------------------------

#   -------------------------------------------------------------
#   Settings for {{ botname }}
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

set runas {{ runas }}

set username {{ botname }}
set nick $username
set altnick {{ botname }}`
set realname "{{ realname }}"

set vhost6 viperserv.nasqueron.org
set listen-addr 2001:470:1f13:9e1:0:c0ff:ee:7
set prefer-ipv6 1

set network libera
set net-type 5

# Main eggdrop settings common to all ViperServ bots
source core.conf

# Credentials for Vault (work in progress) and MySQL (deprecated)
source .credentials

#   -------------------------------------------------------------
#   Vault
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

source scripts/vendor/vault.tcl
source scripts/Vault.tcl

#   -------------------------------------------------------------
#   MySQL
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

load lib/fbsql.so

set sql_credentials [dict get [vault_get mysql] data]

sql  connect  $sql(host) [dict get $sql_credentials username] [dict get $sql_credentials password]
sql2 connect  $sql(host) [dict get $sql_credentials username] [dict get $sql_credentials password]
sql  selectdb $sql(database)
sql2 selectdb $sql(database)

unset sql_credentials

#   -------------------------------------------------------------
#   Base settings with scripts dependencies
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

# Dependencies
source scripts/Core.tcl

# Settings
{%- if nickserv %}
set nickserv_password [vault_get nickserv/$username password]

set servers "
    irc.libera.chat:+6697:$username:$nickserv_password
"
{% else %}
set servers {
    irc.libera.chat:+6697
}
{%- endif %}

#   -------------------------------------------------------------
#   Eggdrop modules
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
{% for module in modules %}
loadmodule {{ module }}{% endfor %}

#   -------------------------------------------------------------
#   Scripts
#
#   These scripts are provided by the rVIPER distribution.
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

source scripts/IRC.tcl
source scripts/Tech.tcl
{% for script in scripts %}
source scripts/{{ script }}{% endfor %}
source scripts/vendor/action.fix.tcl
