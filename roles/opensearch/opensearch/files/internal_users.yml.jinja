#   -------------------------------------------------------------
#   OpenSearch configuration
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#   Project:        Nasqueron
#   License:        Trivial work, not eligible to copyright
#   Source file:    roles/opensearch/opensearch/files/internal_users.yml.jinja
#   -------------------------------------------------------------
#
#   <auto-generated>
#       This file is managed by our rOPS SaltStack repository.
#
#       Changes to this file may cause incorrect behavior
#       and will be lost if the state is redeployed.
#   </auto-generated>

_meta:
  type: "internalusers"
  config_version: 2

#   -------------------------------------------------------------
#   Reserved users to ensure access continuity
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

{{ users['admin']['username'] }}:
  hash: {{ salt['opensearch.hash_password'](users['admin']['password']) }}
  reserved: true
  backend_roles:
    - "admin"
  description: "Alternative admin user"

#   -------------------------------------------------------------
#   Dashboards (formerly Kibana)
#
#   Currently, it seems easier to use hardcoded `kibanaserver` name
#   instead of assign a backend role.
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

{{ users['dashboards']['username'] }}:
  hash: {{ salt['opensearch.hash_password'](users['dashboards']['password']) }}
  reserved: true
  description: "Dashboards to OpenSearch machine user"

#   -------------------------------------------------------------
#   OpenSearch clients to ingest pipelines
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

{% for user in ingest_clients_users %}

{{ users[user]['username'] }}:
  hash: {{ salt['opensearch.hash_password'](users[user]['password']) }}
  reserved: true
  opendistro_security_roles:
    - "ingest_client"
  description: "Ingest client machine user"

{% endfor %}
