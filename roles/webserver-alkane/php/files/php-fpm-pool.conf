;   -------------------------------------------------------------
;   php-fpm pool configuration
;   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
;   Project:        Nasqueron
;   License:        Trivial work, not eligible to copyright
;   Source file:    roles/webserver-alkane/php/files/php-fpm-pool.conf
;   -------------------------------------------------------------
;
;   <auto-generated>
;       This file is managed by our rOPS SaltStack repository.
;
;       Changes to this file may cause incorrect behavior
;       and will be lost if the state is redeployed.
;   </auto-generated>

[{{ user }}]
listen = /var/run/web/{{ fqdn }}/php-fpm.sock
listen.owner = {{ user }}
listen.group = web
listen.mode = 0660

user = {{ user }}
group = web

pm = ondemand
pm.max_children = 8
pm.process_idle_timeout = 10s
pm.max_requests = 50

slowlog = /var/log/www/{{ domain }}/{{ subdomain }}-php-slow.log
request_slowlog_timeout = {{ slow_delay }}

catch_workers_output = yes
php_admin_value[error_log] = /var/log/www/{{ domain }}/{{ subdomain }}-php.log
php_flag[display_errors] = {{ display_errors }}
php_flag[display_startup_errors] = {{ display_errors }}
php_admin_flag[log_errors] = on

{% if 'wordpress' in capabilities -%}
; Allow Wordpress to process large images
php_value[memory_limit] = 1024M
{%- endif %}

; Don't flood /tmp (T417)
php_value[session.save_path] = /var/tmp/php/sessions/{{ fqdn }}

{%- for key, value in env.items() %}
env["{{ key }}"] = {{ value }}
{%- endfor -%}
