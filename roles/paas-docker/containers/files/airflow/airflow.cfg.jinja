#   -------------------------------------------------------------
#   PaaS Docker - Airflow configuration
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#   Project:        Nasqueron
#   License:        Trivial work, not eligible to copyright
#   Source file:    roles/paas-docker/containers/files/airflow/airflow.cfg.jinja
#   Realm:          {{ realm }}
#   -------------------------------------------------------------
#
#   <auto-generated>
#       This file is managed by our rOPS SaltStack repository.
#
#       Changes to this file may cause incorrect behavior
#       and will be lost if the state is redeployed.
#   </auto-generated>

[core]
executor = CeleryExecutor

dags_are_paused_at_creation = True
load_examples = False

fernet_key = {{ credentials.fernet_key }}

[database]
sql_alchemy_conn = postgresql+psycopg2://{{ credentials.db }}

load_default_connections = False

[secrets]
backend = airflow.providers.hashicorp.secrets.vault.VaultBackend
backend_kwargs = {
    "url": "{{ vault.url }}",
    "auth_type": "approle",
    "role_id": "{{ credentials.vault.username }}",
    "secret_id": "{{ credentials.vault.password }}",

    "mount_point": "{{ vault.mount_point }}",
    "connections_path": "{{ vault.secrets_path }}/connections",
    "config_path": "{{ vault.secrets_path }}/config",
    "variables_path": "{{ vault.secrets_path }}/variables"
  }

[api]
auth_backends = airflow.api.auth.backend.basic_auth,airflow.api.auth.backend.session

[sentry]
sentry_on = True
sentry_dsn = {{ credentials.sentry }}

[celery]
broker_url = redis://:@{{ services.redis }}:6379/0
result_backend = db+postgresql://{{ credentials.db }}
