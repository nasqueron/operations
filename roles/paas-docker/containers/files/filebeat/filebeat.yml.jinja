#   -------------------------------------------------------------
#   OpenSearch
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#   Project:        Nasqueron
#   License:        Trivial work, not eligible to copyright
#   Source file:    roles/paas-docker/containers/files/filebeat/filebeat.yml.jinja
#   -------------------------------------------------------------
#
#   <auto-generated>
#       This file is managed by our rOPS SaltStack repository.
#
#       Changes to this file may cause incorrect behavior
#       and will be lost if the state is redeployed.
#   </auto-generated>

filebeat.inputs:
- type: container
  paths:
    - /var/lib/docker/containers/*/*.log
  ignore_older: {{ retention }}

processors:
- add_fields:
    target: ""
    fields:
      host: {{ host }}
      forest: {{ forest }}

- add_docker_metadata:
    host: unix:///var/run/docker.sock

- decode_json_fields:
    fields:
      - message
    target: json
    overwrite_keys: True

output.elasticsearch:
  hosts:
    - {{ elastic['server'] }}
{% if with_cacert %}
  ssl:
    certificate_authorities:
      - /usr/share/filebeat/cacert.pem
{% endif %}
  username: {{ elastic_username }}
  password: {{ elastic_password }}
  indices:
    - index: {{ elastic['index'] }}

logging.json: True
logging.metrics.enabled: False
